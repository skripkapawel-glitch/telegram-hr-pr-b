import os
import requests
import datetime
import random
import sys
import json
import hashlib
from dotenv import load_dotenv

load_dotenv()

BOT_TOKEN = os.getenv("BOT_TOKEN")
MAIN_CHANNEL_ID = "@hr_na_dache"  # –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª –¥–ª—è –¢–ì
ZEN_CHANNEL_ID = -1003322670507   # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–∞–Ω–∞–ª –¥–ª—è –î–∑–µ–Ω–∞
GEMINI_API_KEY = os.getenv("GEMINI_API_KEY")

print("=" * 80)
print("üöÄ –£–ú–ù–´–ô –ë–û–¢: –í–°–¢–†–û–ï–ù–ù–´–ô –ü–û–ò–°–ö GEMINI + –ê–ö–¢–£–ê–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø")
print("=" * 80)

class SmartPostGenerator:
    def __init__(self):
        self.themes = ["HR –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º", "PR –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏", "—Ä–µ–º–æ–Ω—Ç –∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ"]
        self.author = "–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ ‚Ä¢ SMM ‚Ä¢ PR ‚Ä¢ –ö–æ–ø–∏—Ä–∞–π—Ç–µ—Ä (40 –ª–µ—Ç –æ–ø—ã—Ç–∞)"
        
        # –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ—Å—Ç–æ–≤
        self.history_file = "post_history.json"
        self.post_history = self.load_post_history()
        
        # –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
        self.theme_images = {
            "HR –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º": [
                "https://source.unsplash.com/1200x630/?office,team,meeting,hr",
                "https://source.unsplash.com/1200x630/?recruitment,interview,workplace",
                "https://source.unsplash.com/1200x630/?leadership,management,corporate"
            ],
            "PR –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏": [
                "https://source.unsplash.com/1200x630/?media,press,communication,pr",
                "https://source.unsplash.com/1200x630/?public,relations,marketing,branding",
                "https://source.unsplash.com/1200x630/?social,media,network,advertising"
            ],
            "—Ä–µ–º–æ–Ω—Ç –∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ": [
                "https://source.unsplash.com/1200x630/?renovation,construction,repair",
                "https://source.unsplash.com/1200x630/?building,architecture,design",
                "https://source.unsplash.com/1200x630/?interior,home,apartment"
            ]
        }
        
    def load_post_history(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å—Ç–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞"""
        try:
            if os.path.exists(self.history_file):
                with open(self.history_file, 'r', encoding='utf-8') as f:
                    return json.load(f)
            return {}
        except:
            return {}
    
    def save_post_history(self):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å—Ç–æ–≤ –≤ —Ñ–∞–π–ª"""
        try:
            with open(self.history_file, 'w', encoding='utf-8') as f:
                json.dump(self.post_history, f, ensure_ascii=False, indent=2)
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏: {e}")
    
    def generate_post_hash(self, text):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ö–µ—à –ø–æ—Å—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏"""
        return hashlib.md5(text.encode('utf-8')).hexdigest()
    
    def is_post_unique(self, post_text, channel_id):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –±—ã–ª –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –ø–æ—Å—Ç –≤ —ç—Ç–æ–º –∫–∞–Ω–∞–ª–µ"""
        post_hash = self.generate_post_hash(post_text)
        channel_key = str(channel_id)
        
        if channel_key not in self.post_history:
            self.post_history[channel_key] = []
        
        recent_posts = self.post_history[channel_key][-50:]
        return post_hash not in recent_posts
    
    def add_to_history(self, post_text, channel_id):
        """–î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ—Å—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é"""
        post_hash = self.generate_post_hash(post_text)
        channel_key = str(channel_id)
        
        if channel_key not in self.post_history:
            self.post_history[channel_key] = []
        
        self.post_history[channel_key].append(post_hash)
        if len(self.post_history[channel_key]) > 100:
            self.post_history[channel_key] = self.post_history[channel_key][-50:]
        
        self.save_post_history()
    
    def generate_tg_post_with_search(self, theme):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ—Å—Ç –¥–ª—è Telegram —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –ø–æ–∏—Å–∫–æ–º Gemini"""
        prompt = f"""
        {self.author}

        ‚∏ª
        –ò–°–ü–û–õ–¨–ó–£–ô –ü–û–ò–°–ö –í –ò–ù–¢–ï–†–ù–ï–¢–ï –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –ê–ö–¢–£–ê–õ–¨–ù–û–ô –ò–ù–§–û–†–ú–ê–¶–ò–ò

        –°–û–ó–î–ê–ô –ê–ö–¢–£–ê–õ–¨–ù–´–ô –ü–û–°–¢ –î–õ–Ø TELEGRAM –ù–ê –¢–ï–ú–£: {theme}
        –ì–û–î: 2024-2025

        üîµ –®–ê–ë–õ–û–ù –î–õ–Ø TELEGRAM:

        1. –ó–∞—Ü–µ–ø–∫–∞ (–æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
        {{–∏–Ω—Ç—Ä–∏–≥–∞ –∏–ª–∏ –±–æ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–Ω–¥–æ–≤}}

        ‚∏ª

        2. –ö–æ–Ω—Ç–µ–∫—Å—Ç (–∏—Å–ø–æ–ª—å–∑—É–π —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ–∏—Å–∫–∞)
        {{—á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ —Å–µ–π—á–∞—Å, —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã}}

        ‚∏ª

        3. –ì–ª–∞–≤–Ω–∞—è –º—ã—Å–ª—å
        {{–≤—ã–≤–æ–¥ –∏–∑ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏}}

        ‚∏ª

        4. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ª—å–∑–∞ (–Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–Ω–¥–æ–≤)
        ‚Ä¢ {{–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–æ–≤–µ—Ç 1}}
        ‚Ä¢ {{–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–æ–≤–µ—Ç 2}} 
        ‚Ä¢ {{–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–æ–≤–µ—Ç 3}}

        ‚∏ª

        5. –ü—Ä–æ–≥–Ω–æ–∑ –∏–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
        {{—á—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏}}

        ‚∏ª

        6. –í–æ–ø—Ä–æ—Å –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è
        {{–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö}}

        ‚∏ª

        –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
        ‚úÖ –ò–°–ü–û–õ–¨–ó–£–ô –ü–û–ò–°–ö –í –ò–ù–¢–ï–†–ù–ï–¢–ï –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        ‚úÖ –¢–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ 2024-2025 –≥–æ–¥—ã
        ‚úÖ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏ —Ü–∏—Ñ—Ä—ã
        ‚úÖ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ª—å–∑–∞ –¥–ª—è —á–∏—Ç–∞—Ç–µ–ª—è
        ‚ùå –ë–µ–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏ –≥–∏–±—Ä–∏–¥–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
        ‚úÖ –¢–æ–ª—å–∫–æ –æ—Ñ–∏—Å–Ω—ã–µ/—Ä–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã
        ‚úÖ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫, –±–µ–∑ —à–∞–±–ª–æ–Ω–Ω–æ—Å—Ç–∏

        –ù–∞–π–¥–∏ —Å–∞–º—É—é –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Ç–µ–º–µ "{theme}" –∑–∞ 2024-2025 –≥–æ–¥—ã!
        """

        try:
            print(f"üß† –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¢–ì-–ø–æ—Å—Ç–∞ —Å –ø–æ–∏—Å–∫–æ–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ: {theme}...")
            url = f"https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key={GEMINI_API_KEY}"
            
            # –í–∫–ª—é—á–∞–µ–º –ø–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
            response = requests.post(
                url,
                json={
                    "contents": [{
                        "parts": [{"text": prompt}],
                        "tools": [{"google_search_retrieval": {}}]  # –í–ö–õ–Æ–ß–ê–ï–ú –ü–û–ò–°–ö
                    }],
                    "generationConfig": {
                        "maxOutputTokens": 800,
                        "temperature": 0.9,
                    }
                },
                timeout=60  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞
            )
            
            if response.status_code == 200:
                data = response.json()
                post_text = data["candidates"][0]["content"]["parts"][0]["text"].strip()
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Ç–µ–º—ã
                banned_keywords = ["—É–¥–∞–ª–µ–Ω", "–≥–∏–±—Ä–∏–¥–Ω", "remote", "home office", "–¥–∏—Å—Ç–∞–Ω—Ü"]
                for keyword in banned_keywords:
                    if keyword in post_text.lower():
                        print(f"üö´ –û–ë–ù–ê–†–£–ñ–ï–ù –ó–ê–ü–†–ï–©–ï–ù–ù–´–ô –ö–õ–Æ–ß: {keyword}")
                        return self.generate_fallback_post(theme, is_tg=True)
                
                print(f"‚úÖ –¢–ì-–ø–æ—Å—Ç –≥–æ—Ç–æ–≤ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ ({len(post_text)} —Å–∏–º–≤–æ–ª–æ–≤)")
                return post_text
            else:
                print(f"‚ùå –û—à–∏–±–∫–∞ Gemini: {response.status_code}")
                return self.generate_fallback_post(theme, is_tg=True)
                
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¢–ì: {e}")
            return self.generate_fallback_post(theme, is_tg=True)
    
    def generate_zen_post_with_search(self, theme):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ—Å—Ç –¥–ª—è –î–∑–µ–Ω–∞ —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –ø–æ–∏—Å–∫–æ–º Gemini"""
        prompt = f"""
        {self.author}

        –¢—Ä–µ–Ω–¥—ã –î–∑–µ–Ω–∞ 2025: —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ—Å—Ç—å, —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏.

        ‚∏ª
        –ò–°–ü–û–õ–¨–ó–£–ô –ü–û–ò–°–ö –í –ò–ù–¢–ï–†–ù–ï–¢–ï –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –ê–ö–¢–£–ê–õ–¨–ù–´–• –î–ê–ù–ù–´–•

        –°–û–ó–î–ê–ô –ê–ù–ê–õ–ò–¢–ò–ß–ï–°–ö–ò–ô –ü–û–°–¢ –î–õ–Ø –Ø–ù–î–ï–ö–°.–î–ó–ï–ù –ù–ê –¢–ï–ú–£: {theme}
        –ì–û–î: 2024-2025

        üü° –®–ê–ë–õ–û–ù –î–õ–Ø –Ø–ù–î–ï–ö–°.–î–ó–ï–ù–ê:

        1. –ó–∞–≥–æ–ª–æ–≤–æ–∫ (SEO + –∏–Ω—Ç—Ä–∏–≥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

        ‚∏ª

        2. –ò–Ω—Ç—Ä–æ (–≤–≤–æ–¥–Ω—ã–π –∞–±–∑–∞—Ü –æ —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –≤ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏)

        ‚∏ª

        3. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã (–∏—Å–ø–æ–ª—å–∑—É–π —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ–∏—Å–∫–∞)

        ‚∏ª

        4. –ö–ª—é—á–µ–≤–æ–π –∏–Ω—Å–∞–π—Ç (–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —Å–≤–µ–∂–∏—Ö —Ç—Ä–µ–Ω–¥–∞—Ö)

        ‚∏ª

        5. –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏:

        ‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã 2024-2025
        {{–Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–∏—Å–∫–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ}}

        ‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ  
        {{–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –∏ –ø—Ä–∏–º–µ—Ä—ã}}

        ‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        {{—á—Ç–æ –¥–µ–ª–∞—Ç—å –≤ —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏}}

        ‚∏ª

        6. –ü—Ä–æ–≥–Ω–æ–∑ —Ä–∞–∑–≤–∏—Ç–∏—è (–Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö)

        ‚∏ª

        7. –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

        ‚∏ª

        –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
        ‚úÖ –ò–°–ü–û–õ–¨–ó–£–ô –ü–û–ò–°–ö –í –ò–ù–¢–ï–†–ù–ï–¢–ï –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ 2024-2025
        ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
        ‚úÖ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        ‚ùå –ë–µ–∑ —ç–º–æ–¥–∑–∏, —Ö–µ—à—Ç–µ–≥–æ–≤, —É–ø–æ–º–∏–Ω–∞–Ω–∏–π
        ‚ùå –ë–µ–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã
        ‚úÖ –¢–æ–ª—å–∫–æ –æ—Ñ–∏—Å–Ω—ã–µ/—Ä–µ–∞–ª—å–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–∫–µ–π—Å—ã

        –ù–∞–π–¥–∏ —Å–∞–º—É—é —Å–≤–µ–∂—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Ç–µ–º–µ "{theme}" –∑–∞ 2024-2025 –≥–æ–¥—ã!
        """

        try:
            print(f"üß† –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –î–∑–µ–Ω-–ø–æ—Å—Ç–∞ —Å –ø–æ–∏—Å–∫–æ–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ: {theme}...")
            url = f"https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key={GEMINI_API_KEY}"
            
            # –í–∫–ª—é—á–∞–µ–º –ø–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
            response = requests.post(
                url,
                json={
                    "contents": [{
                        "parts": [{"text": prompt}],
                        "tools": [{"google_search_retrieval": {}}]  # –í–ö–õ–Æ–ß–ê–ï–ú –ü–û–ò–°–ö
                    }],
                    "generationConfig": {
                        "maxOutputTokens": 1000,
                        "temperature": 0.8,
                    }
                },
                timeout=60  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞
            )
            
            if response.status_code == 200:
                data = response.json()
                post_text = data["candidates"][0]["content"]["parts"][0]["text"].strip()
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Ç–µ–º—ã
                banned_keywords = ["—É–¥–∞–ª–µ–Ω", "–≥–∏–±—Ä–∏–¥–Ω", "remote", "home office", "–¥–∏—Å—Ç–∞–Ω—Ü"]
                for keyword in banned_keywords:
                    if keyword in post_text.lower():
                        print(f"üö´ –û–ë–ù–ê–†–£–ñ–ï–ù –ó–ê–ü–†–ï–©–ï–ù–ù–´–ô –ö–õ–Æ–ß: {keyword}")
                        return self.generate_fallback_post(theme, is_tg=False)
                
                print(f"‚úÖ –î–∑–µ–Ω-–ø–æ—Å—Ç –≥–æ—Ç–æ–≤ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ ({len(post_text)} —Å–∏–º–≤–æ–ª–æ–≤)")
                return post_text
            else:
                print(f"‚ùå –û—à–∏–±–∫–∞ Gemini: {response.status_code}")
                return self.generate_fallback_post(theme, is_tg=False)
                
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –î–∑–µ–Ω: {e}")
            return self.generate_fallback_post(theme, is_tg=False)
    
    def generate_fallback_post(self, theme, is_tg=True):
        """–†–µ–∑–µ—Ä–≤–Ω—ã–π –ø–æ—Å—Ç –µ—Å–ª–∏ –ø–æ–∏—Å–∫ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª"""
        if is_tg:
            return f"""üöÄ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã {theme} 2024-2025

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã —Ç—Ä–µ–±—É—é—Ç –Ω–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π.

‚∏ª

–ò–Ω–¥—É—Å—Ç—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è –ø–æ–¥ –≤–ª–∏—è–Ω–∏–µ–º –Ω–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π —Ä—ã–Ω–∫–∞.

‚∏ª

–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∫–ª—é—á–µ–≤—ã–º –Ω–∞–≤—ã–∫–æ–º –≤ —Ç–µ–∫—É—â–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö.

‚∏ª

‚Ä¢ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
‚Ä¢ –§–æ–∫—É—Å –Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
‚Ä¢ –†–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π
‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç

‚∏ª

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–æ—Å—Ç–∏–≥–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –±—ã—Å—Ç—Ä–µ–µ –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ.

‚∏ª

–ö–∞–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤–∞—à–µ–π —Å—Ñ–µ—Ä–µ –Ω–∞–∏–±–æ–ª–µ–µ –∑–Ω–∞—á–∏–º—ã?

#{theme.replace(' ', '')} #—Ç—Ä–µ–Ω–¥—ã2025 #–±–∏–∑–Ω–µ—Å"""
        else:
            return f"""–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏ {theme.lower()} 2024-2025

–ê–Ω–∞–ª–∏–∑ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –≤—ã–∑–æ–≤–æ–≤ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å—Ñ–µ—Ä–µ.

‚∏ª

–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–∏–∑–Ω–µ—Å-—Å—Ä–µ–¥–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è rapid –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –∏ –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–ª—é—á–µ–≤—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è.

‚∏ª

–û—Å–Ω–æ–≤–Ω–æ–π –≤—ã–∑–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ–π –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –∫ –º–µ–Ω—è—é—â–∏–º—Å—è —É—Å–ª–æ–≤–∏—è–º –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

‚∏ª

–¶–∏—Ñ—Ä–æ–≤–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è

–í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º —É—Å–ª–æ–≤–∏–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤ 2024-2025 –≥–æ–¥–∞—Ö.

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

–ü–µ—Ä–µ—Å–º–æ—Ç—Ä —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á.

–†–∞–∑–≤–∏—Ç–∏–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π

–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ - –∫–ª—é—á–µ–≤–æ–π —Ñ–∞–∫—Ç–æ—Ä —É—Å–ø–µ—Ö–∞ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.

‚∏ª

–ö–æ–º–ø–∞–Ω–∏–∏, —É—Å–ø–µ—à–Ω–æ –≤–Ω–µ–¥—Ä—è—é—â–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç —É—Å—Ç–æ–π—á–∏–≤—ã–π —Ä–æ—Å—Ç –¥–∞–∂–µ –≤ —É—Å–ª–æ–≤–∏—è—Ö –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

‚∏ª

–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ —Ç–µ–∫—É—â–∏–º –≤—ã–∑–æ–≤–∞–º, –Ω–æ –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Å–Ω–æ–≤—É –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.

‚∏ª

–ö–∞–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã –≤ –≤–∞—à–µ–π –∏–Ω–¥—É—Å—Ç—Ä–∏–∏?"""
    
    def add_tg_hashtags(self, theme):
        """–î–æ–±–∞–≤–ª—è–µ—Ç —Ö–µ—à—Ç–µ–≥–∏ –¥–ª—è Telegram"""
        hashtags = {
            "HR –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º": "#HR #—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #–∫–æ–º–∞–Ω–¥–∞ #–æ—Ñ–∏—Å #–ø–µ—Ä—Å–æ–Ω–∞–ª #2025",
            "PR –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏": "#PR #–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ #–±—Ä–µ–Ω–¥ #–º–µ–¥–∏–∞ #–º–∞—Ä–∫–µ—Ç–∏–Ω–≥ #2025", 
            "—Ä–µ–º–æ–Ω—Ç –∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ": "#—Ä–µ–º–æ–Ω—Ç #—Å—Ç—Ä–æ–π–∫–∞ #–¥–∏–∑–∞–π–Ω #–∏–Ω—Ç–µ—Ä—å–µ—Ä #–∫–≤–∞—Ä—Ç–∏—Ä–∞ #2025"
        }
        return hashtags.get(theme, "#2025")
    
    def get_theme_image(self, theme):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é"""
        return random.choice(self.theme_images.get(theme, self.theme_images["HR –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º"]))
    
    def send_to_telegram(self, chat_id, text, image_url):
        """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Å—Ç –≤ Telegram —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π"""
        url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendPhoto"
        payload = {
            "chat_id": chat_id,
            "photo": image_url,
            "caption": text,
            "parse_mode": "HTML"
        }
        
        try:
            response = requests.post(url, json=payload, timeout=15)
            if response.status_code == 200:
                self.add_to_history(text, chat_id)
                return True
            return False
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {e}")
            return False
    
    def send_dual_posts(self):
        """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏"""
        theme = random.choice(self.themes)
        print(f"üéØ –í—ã–±—Ä–∞–Ω–∞ —Ç–µ–º–∞: {theme}")
        
        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é
        theme_image = self.get_theme_image(theme)
        print(f"üñºÔ∏è –§–æ—Ç–æ –¥–ª—è —Ç–µ–º—ã: {theme_image}")
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ—Å—Ç—ã –°–û –í–°–¢–†–û–ï–ù–ù–´–ú –ü–û–ò–°–ö–û–ú
        print("üß† –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤ —Å –ø–æ–∏—Å–∫–æ–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ...")
        tg_post = self.generate_tg_post_with_search(theme)
        zen_post = self.generate_zen_post_with_search(theme)
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ö–µ—à—Ç–µ–≥–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –¢–ì
        tg_full_post = f"{tg_post}\n\n{self.add_tg_hashtags(theme)}"
        
        print(f"üìù –¢–ì-–ø–æ—Å—Ç: {len(tg_full_post)} —Å–∏–º–≤–æ–ª–æ–≤")
        print(f"üìù –î–∑–µ–Ω-–ø–æ—Å—Ç: {len(zen_post)} —Å–∏–º–≤–æ–ª–æ–≤")
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –æ–±–∞ –∫–∞–Ω–∞–ª–∞
        print("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª...")
        tg_success = self.send_to_telegram(MAIN_CHANNEL_ID, tg_full_post, theme_image)
        
        print("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –î–∑–µ–Ω-–∫–∞–Ω–∞–ª...")
        zen_success = self.send_to_telegram(ZEN_CHANNEL_ID, zen_post, theme_image)
        
        if tg_success and zen_success:
            print("‚úÖ –ü–û–°–¢–´ –° –ê–ö–¢–£–ê–õ–¨–ù–´–ú–ò –î–ê–ù–ù–´–ú–ò –£–°–ü–ï–®–ù–û –û–¢–ü–†–ê–í–õ–ï–ù–´!")
            return True
        else:
            print(f"üí• –û–®–ò–ë–ö–ò: –¢–ì={tg_success}, –î–∑–µ–Ω={zen_success}")
            return False

def main():
    print("\nüöÄ –ó–ê–ü–£–°–ö –£–ú–ù–û–ì–û –ì–ï–ù–ï–†–ê–¢–û–†–ê")
    print("üéØ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ Gemini –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ")
    print("üéØ –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è 2024-2025")
    print("üéØ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ - —Ç–≤–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Gemini API")
    print("=" * 80)
    
    bot = SmartPostGenerator()
    success = bot.send_dual_posts()
    
    if success:
        print("\nüéâ –£–°–ü–ï–•! –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –æ–±–∞ –∫–∞–Ω–∞–ª–∞!")
    else:
        print("\nüí• –ï–°–¢–¨ –û–®–ò–ë–ö–ò –û–¢–ü–†–ê–í–ö–ò!")
    
    print("=" * 80)

if __name__ == "__main__":
    main()
