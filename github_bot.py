import os
import random
import requests
import datetime
import hashlib
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
load_dotenv()

BOT_TOKEN = os.getenv("BOT_TOKEN")
CHANNEL_ID = os.getenv("CHANNEL_ID")
GEMINI_API_KEY = os.getenv("GEMINI_API_KEY")

# –ë–û–õ–¨–®–ê–Ø –ë–ê–ó–ê –¢–ï–ú –ò –°–¢–ò–õ–ï–ô
HR_CATEGORIES = [
    "—Ä–µ–∫—Ä—É—Ç–∏–Ω–≥ –∏ –ø–æ–¥–±–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–ª–∞", "–∞–¥–∞–ø—Ç–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤", "–æ–±—É—á–µ–Ω–∏–µ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ", 
    "–æ—Ü–µ–Ω–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞", "–º–æ—Ç–∏–≤–∞—Ü–∏—è –∏ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å", "–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞",
    "—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–ª–∞–Ω—Ç–∞–º–∏", "HR-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞", "–±—Ä–µ–Ω–¥ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è", "—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ performance",
    "–ª–∏–¥–µ—Ä—Å—Ç–≤–æ –∏ –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç", "–∫–æ–º–∞–Ω–¥–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "–æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å", "–∫–∞—Ä—å–µ—Ä–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ",
    "–¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∏–Ω–∫–ª—é–∑–∏–≤–Ω–æ—Å—Ç—å", "—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏", "HR-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è",
    "—Ü–∏—Ñ—Ä–æ–≤–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è HR", "—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏", "—Ç–∏–º–±–∏–ª–¥–∏–Ω–≥", "–æ–Ω–±–æ—Ä–¥–∏–Ω–≥",
    "—Å–∏—Å—Ç–µ–º–∞ –≥—Ä–µ–π–¥–æ–≤", "–Ω–µ–º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è", "KPI –∏ –º–µ—Ç—Ä–∏–∫–∏", "L&D –ø—Ä–æ–≥—Ä–∞–º–º—ã",
    "–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç", "–Ω–∞–≤—ã–∫–∏ –±—É–¥—É—â–µ–≥–æ", "—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è HR", "–º–∏–ª–ª–µ–Ω–∏–∞–ª—ã –∏ –∑—É–º–µ—Ä—ã",
    "—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∫–æ–ª–µ–Ω–∏—è–º–∏", "employer branding", "–∫–∞–Ω–¥–∏–¥–∞—Ç—Å–∫–∏–π –æ–ø—ã—Ç", "—Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã",
    "assessment center", "executive search", "–º–∞—Å—Å–æ–≤—ã–π –ø–æ–¥–±–æ—Ä", "headhunting"
]

PR_CATEGORIES = [
    "–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏", "—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ø—É—Ç–∞—Ü–∏–µ–π", "–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏",
    "–∫—Ä–∏–∑–∏—Å–Ω—ã–π PR", "–º–µ–¥–∏–∞-–æ—Ç–Ω–æ—à–µ–Ω–∏—è", "—Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏", "–±—Ä–µ–Ω–¥ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è",
    "—Å—Ç–æ—Ä–∏—Ç–µ–ª–ª–∏–Ω–≥", "–∏–≤–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç", "—Å–ø–æ–Ω—Å–æ—Ä—Å—Ç–≤–æ", "—Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å",
    "PR-–∫–∞–º–ø–∞–Ω–∏–∏", "—Ä–∞–±–æ—Ç–∞ —Å–æ –°–ú–ò", "–ª–∏—á–Ω—ã–π –±—Ä–µ–Ω–¥ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è", "annual reports",
    "–∏–Ω–≤–µ—Å—Ç–æ—Ä—Å–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è", "–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è", "–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –≤ –∫—Ä–∏–∑–∏—Å",
    "–∞–Ω—Ç–∏–∫—Ä–∏–∑–∏—Å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ", "—Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞", "–ø—É–±–ª–∏—á–Ω—ã–µ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è",
    "–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤", "–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —ç—Ç–∏–∫–∞", "PR-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏"
]

STYLES = [
    "—Ä–∞–∑–±–æ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–µ–π—Å–∞", "—ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–µ –º–Ω–µ–Ω–∏–µ", "–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ",
    "–∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤", "–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ", "–∏—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—Ö–∞", "—Ä–∞–∑–±–æ—Ä –æ—à–∏–±–æ–∫",
    "—á–µ–∫-–ª–∏—Å—Ç", "—Å–æ–≤–µ—Ç—ã –æ—Ç –ø—Ä–∞–∫—Ç–∏–∫–∞", "–ø—Ä–æ–≥–Ω–æ–∑ —Ä–∞–∑–≤–∏—Ç–∏—è", "—Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑",
    "–∏–Ω—Ç–µ—Ä–≤—å—é —Å —ç–∫—Å–ø–µ—Ä—Ç–æ–º", "—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ", "–ª–∞–π—Ñ—Ö–∞–∫–∏",
    "–Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥", "–∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–∞—è –º–µ—Ç–æ–¥–∏–∫–∞", "best practices",
    "case study", "lessons learned", "–∏–Ω—Å–∞–π—Ç –æ—Ç –ø—Ä–∞–∫—Ç–∏–∫–∞", "–ø—Ä–æ–≤–æ–∫–∞—Ü–∏–æ–Ω–Ω–æ–µ –º–Ω–µ–Ω–∏–µ",
    "—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç", "—é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –Ω—é–∞–Ω—Å", "–∫—Ä–æ—Å—Å-–∫—É–ª—å—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑"
]

BUSINESS_AREAS = [
    "IT –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "—Ñ–∏–Ω–∞–Ω—Å—ã –∏ –±–∞–Ω–∫–∏–Ω–≥", "—Ä–æ–∑–Ω–∏—á–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è", "–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ",
    "–∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ", "–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "–∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥", "—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ", "–ª–æ–≥–∏—Å—Ç–∏–∫–∞",
    "–≥–æ—Å—Ç–∏–Ω–∏—á–Ω—ã–π –±–∏–∑–Ω–µ—Å", "—Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω—ã–π –±–∏–∑–Ω–µ—Å", "–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å", "–º–µ–¥–∏–∞ –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è",
    "—Ñ–∞—Ä–º–∞—Ü–µ–≤—Ç–∏–∫–∞", "–∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω–∞—è –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å", "—Ç–µ–ª–µ–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏", "—ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞"
]

FORMATS = [
    "üìù {content}", "üéØ {content}", "üí° {content}", "üìä {content}",
    "üöÄ {content}", "ü§î {content}", "‚úÖ {content}", "üìà {content}",
    "üë• {content}", "üå± {content}", "‚ö° {content}", "üèÜ {content}",
    "üíº {content}", "üåü {content}", "üîç {content}", "üíé {content}"
]

ENGAGEMENT_ELEMENTS = [
    "–ê –∫–∞–∫ —É –≤–∞—Å –≤ –∫–æ–º–ø–∞–Ω–∏–∏ —Å —ç—Ç–∏–º?",
    "–°–æ–≥–ª–∞—Å–Ω—ã —Å —Ç–∞–∫–∏–º –ø–æ–¥—Ö–æ–¥–æ–º?",
    "–ö–∞–∫–æ–π –æ–ø—ã—Ç —É –≤–∞—Å –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ?",
    "–ß—Ç–æ –±—ã –≤—ã –¥–æ–±–∞–≤–∏–ª–∏ –∏–∑ —Å–≤–æ–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏?",
    "–° –∫–∞–∫–∏–º–∏ –≤—ã–∑–æ–≤–∞–º–∏ —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç–µ—Å—å –≤ —ç—Ç–æ–π –æ–±–ª–∞—Å—Ç–∏?",
    "–ö–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è?",
    "–ö–∞–∫ —ç—Ç–∞ —Ç–µ–º–∞ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –≤–∞—à–µ–π —Ä–∞–±–æ—Ç–µ?",
    "–ß—Ç–æ –∏–∑ —ç—Ç–æ–≥–æ —É–∂–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ?",
    "–° –∫–∞–∫–∏–º–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—è–º–∏ —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å?",
    "–ß—Ç–æ –±—ã –≤—ã —Å–¥–µ–ª–∞–ª–∏ –∏–Ω–∞—á–µ?",
    "–ö–∞–∫–æ–π —Å–∞–º—ã–π —Ü–µ–Ω–Ω—ã–π —É—Ä–æ–∫ –∏–∑–≤–ª–µ–∫–ª–∏?",
    "–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ –≤—Å–µ–≥–æ –≤ –≤–∞—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–µ?"
]

def send_post_with_image(message, image_url=None):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Å—Ç —Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π"""
    try:
        if image_url:
            url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendPhoto"
            payload = {
                "chat_id": CHANNEL_ID,
                "photo": image_url,
                "caption": message,
                "parse_mode": "HTML"
            }
        else:
            url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"
            payload = {
                "chat_id": CHANNEL_ID,
                "text": message,
                "parse_mode": "HTML"
            }
        
        response = requests.post(url, json=payload, timeout=30)
        response.raise_for_status()
        print("‚úÖ –ü–æ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!")
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {e}")
        return False

def get_image_for_post(theme_keywords):
    """–ü–æ–ª—É—á–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –ø–æ—Å—Ç–∞"""
    unique_seed = f"{theme_keywords}{datetime.datetime.now().strftime('%Y%m%d%H%M%S')}"
    seed_hash = int(hashlib.md5(unique_seed.encode()).hexdigest()[:8], 16)
    image_url = f"https://picsum.photos/1200/800?random={seed_hash}"
    print(f"üñºÔ∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É: {image_url}")
    return image_url

def generate_unique_post(time_of_day):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ Google Gemini"""
    
    length_config = {
        "morning": {"max_tokens": 600, "ideal_length": 400, "temperature": 0.95},
        "afternoon": {"max_tokens": 1200, "ideal_length": 800, "temperature": 0.95}, 
        "evening": {"max_tokens": 500, "ideal_length": 300, "temperature": 0.95}
    }
    
    config = length_config[time_of_day]
    
    # –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞
    now = datetime.datetime.now()
    unique_seed = f"{now.timestamp()}{CHANNEL_ID}{time_of_day}"
    random.seed(int(hashlib.md5(unique_seed.encode()).hexdigest()[:8], 16))
    
    # –°–ª—É—á–∞–π–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ—Å—Ç–∞
    all_categories = HR_CATEGORIES + PR_CATEGORIES
    category = random.choice(all_categories)
    style = random.choice(STYLES)
    business_area = random.choice(BUSINESS_AREAS)
    engagement = random.choice(ENGAGEMENT_ELEMENTS)
    post_format = random.choice(FORMATS)
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–∫—Ü–µ–Ω—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–Ω—è
    time_focus = {
        "morning": "—ç–Ω–µ—Ä–≥–∏—á–Ω—ã–π —Å—Ç–∞—Ä—Ç –¥–Ω—è, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",
        "afternoon": "–≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑, —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ, —Ä–µ—à–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á", 
        "evening": "–ø–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤, —Ä–µ—Ñ–ª–µ–∫—Å–∏—è, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞"
    }[time_of_day]
    
    prompt = f"""
    –°–û–ó–î–ê–ô –ê–ë–°–û–õ–Æ–¢–ù–û –£–ù–ò–ö–ê–õ–¨–ù–´–ô –ò –¶–ï–ü–õ–Ø–Æ–©–ò–ô –ü–û–°–¢ –î–õ–Ø TELEGRAM –ö–ê–ù–ê–õ–ê PRO HR & PR
    
    üéØ –ö–ê–¢–ï–ì–û–†–ò–Ø: {category}
    üìñ –°–¢–ò–õ–¨ –ü–û–î–ê–ß–ò: {style}
    üè¢ –°–§–ï–†–ê –ë–ò–ó–ù–ï–°–ê: {business_area}
    üïí –ê–ö–¶–ï–ù–¢: {time_focus}
    
    –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
    - –ü–æ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ù–ê 100% –£–ù–ò–ö–ê–õ–¨–ù–´–ú –∏ –ù–ï–ü–û–í–¢–û–†–Ø–Æ–©–ò–ú–°–Ø
    - –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Ç—Ä–µ–Ω–¥—ã 2024-2025 –≥–æ–¥–∞
    - –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∏ –ø—Ä–∞–∫—Ç–∏–∫–µ
    - –ë–µ–∑ —à–∞–±–ª–æ–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑ –∏ –∫–ª–∏—à–µ
    
    –°–¢–†–£–ö–¢–£–†–ê –ü–û–°–¢–ê:
    1. –ó–ê–ì–û–õ–û–í–û–ö - –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π, —Ü–µ–ø–ª—è—é—â–∏–π, –≤—ã–∑—ã–≤–∞—é—â–∏–π –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ
    2. –†–ê–°–ö–†–´–¢–ò–ï –¢–ï–ú–´ - –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ —Ü–∏—Ñ—Ä–∞–º–∏
    3. –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ê–Ø –¶–ï–ù–ù–û–°–¢–¨ - —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ—á—Ç–µ–Ω–∏—è
    4. –ü–†–ò–ó–´–í –ö –û–ë–°–£–ñ–î–ï–ù–ò–Æ - {engagement}
    
    –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
    - –î–ª–∏–Ω–∞: {config['ideal_length']}-{config['max_tokens']} —Å–∏–º–≤–æ–ª–æ–≤
    - –¢–æ–ª—å–∫–æ —Å–≤–µ–∂–∞—è –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è (—É–∫–∞–∂–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏)
    - –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π
    - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–π —è–∑—ã–∫
    - –≠–º–æ–¥–∑–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
    - –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Å—Ç–∏–ª—å
    
    –ó–ê–ü–†–ï–©–ï–ù–û:
    - –£–ø–æ–º–∏–Ω–∞—Ç—å —É–¥–∞–ª–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É, –≥–∏–±—Ä–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, —Ä–∞–±–æ—Ç—É –∏–∑ –¥–æ–º–∞
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã –∏ –∫–ª–∏—à–µ
    - –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–æ—Å—Ç–æ–≤
    
    –ò–ù–§–û–†–ú–ê–¶–ò–Ø –î–û–õ–ñ–ù–ê –ë–´–¢–¨ –û–°–ù–û–í–ê–ù–ê –ù–ê:
    - –ê–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö (McKinsey, Deloitte, PwC, HBR)
    - –†–µ–∞–ª—å–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–∫–µ–π—Å–∞—Ö
    - –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–º –æ–ø—ã—Ç–µ –∫–æ–º–ø–∞–Ω–∏–π
    
    –°–î–ï–õ–ê–ô –¢–ê–ö, –ß–¢–û–ë–´:
    - –•–æ—Ç–µ–ª–æ—Å—å –¥–æ—á–∏—Ç–∞—Ç—å –¥–æ –∫–æ–Ω—Ü–∞
    - –ü–æ—è–≤–∏–ª–æ—Å—å –∂–µ–ª–∞–Ω–∏–µ –æ–±—Å—É–¥–∏—Ç—å –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
    - –ó–∞–ø–æ–º–Ω–∏–ª–æ—Å—å –Ω–∞–¥–æ–ª–≥–æ
    - –í—ã–∑—ã–≤–∞–ª–æ –∂–µ–ª–∞–Ω–∏–µ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –∫–æ–ª–ª–µ–≥–∞–º–∏
    """
    
    try:
        print(f"üß† –ì–µ–Ω–µ—Ä–∏—Ä—É—é –ø–æ—Å—Ç: {category} | {style} | {business_area}")
        
        response = requests.post(
            f"https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key={GEMINI_API_KEY}",
            json={
                "contents": [{"parts": [{"text": prompt}]}],
                "generationConfig": {
                    "maxOutputTokens": config["max_tokens"],
                    "temperature": config["temperature"],
                    "topP": 0.95,
                    "topK": 40
                }
            },
            timeout=45
        )
        
        if response.status_code == 200:
            data = response.json()
            post_text = data["candidates"][0]["content"]["parts"][0]["text"].strip()
            
            # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç
            formatted_text = post_format.format(content=post_text)
            
            # –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É
            image_url = get_image_for_post(f"{category} {business_area}")
            
            return formatted_text, image_url, f"{category} - {business_area}"
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ—Å—Ç–∞: {e}")
    
    # –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
    return get_fallback_post(time_of_day)

def get_fallback_post(time_of_day):
    """–ó–∞–ø–∞—Å–Ω—ã–µ –ø–æ—Å—Ç—ã –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–∫–∏"""
    fallback_posts = [
        {
            "text": """üî• <b>HR-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ 2025: –ö–∞–∫ –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</b>

–ù–æ–≤–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ McKinsey –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: AI-–∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ç–µ–ø–µ—Ä—å –º–æ–≥—É—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 87%!

üìä –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç—å –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –≤ –ø–µ—Ä–≤—ã–µ 90 –¥–Ω–µ–π
‚Ä¢ –£—á–∞—Å—Ç–∏–µ –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö 
‚Ä¢ –î–∏–Ω–∞–º–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è KPI
‚Ä¢ –í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å –≤ –∫—Ä–æ—Å—Å-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã

üí° <b>–ö–µ–π—Å:</b> –ö–æ–º–ø–∞–Ω–∏—è X —Å–Ω–∏–∑–∏–ª–∞ —Ç–µ–∫—É—á–∫—É –Ω–∞ 42% –≤–Ω–µ–¥—Ä–∏–≤ predictive analytics –≤ —Ä–µ–∫—Ä—É—Ç–∏–Ω–≥.

üöÄ <b>–î–µ–π—Å—Ç–≤–∏–µ:</b> –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –≤–∞—à–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–º 10 –Ω–∞–π–º–∞–º.

ü§î <b>–ö–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤?</b>

#HRA–Ω–∞–ª–∏—Ç–∏–∫–∞ #–î–∞–Ω–Ω—ã–µ #–†–µ–∫—Ä—É—Ç–∏–Ω–≥""",
            "image": f"https://picsum.photos/1200/800?random={random.randint(1000, 9999)}"
        },
        {
            "text": """üéØ <b>–ö—Ä–∏–∑–∏—Å–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏: –ö–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–ø—É—Ç–∞—Ü–∏—é –≤ 2025</b>

–ü–æ –¥–∞–Ω–Ω—ã–º PwC, 68% –∫—Ä–∏–∑–∏—Å–æ–≤ –≤ –∫–æ–º–ø–∞–Ω–∏—è—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è—Ö!

üõ°Ô∏è <b>–ê–Ω—Ç–∏–∫—Ä–∏–∑–∏—Å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç:</b>
‚úÖ –ó–∞—Ä–∞–Ω–µ–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤
‚úÖ –ï–¥–∏–Ω—ã–π —Ü–µ–Ω—Ç—Ä –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π
‚úÖ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã
‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Ü—Å–µ—Ç–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

üí° <b>–ü—Ä–∏–º–µ—Ä:</b> –ö–æ–º–ø–∞–Ω–∏—è Y —É–≤–µ–ª–∏—á–∏–ª–∞ –¥–æ–≤–µ—Ä–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ 35% –ø–æ—Å–ª–µ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã—Ö –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π –≤–æ –≤—Ä–µ–º—è –∫—Ä–∏–∑–∏—Å–∞.

üöÄ <b>–ó–∞–¥–∞–Ω–∏–µ:</b> –ü—Ä–æ–≤–µ–¥–∏—Ç–µ —É—á–µ–±–Ω—ã–π –∫—Ä–∏–∑–∏—Å–Ω—ã–π –∫–µ–π—Å —Å –∫–æ–º–∞–Ω–¥–æ–π –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ.

üí¨ <b>–ö–∞–∫ –≥–æ—Ç–æ–≤–∏—Ç–µ—Å—å –∫ –≤–æ–∑–º–æ–∂–Ω—ã–º –∫—Ä–∏–∑–∏—Å–∞–º –≤ –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏?</b>

#–ö—Ä–∏–∑–∏—Å–Ω—ã–πPR #–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ #–†–µ–ø—É—Ç–∞—Ü–∏—è""",
            "image": f"https://picsum.photos/1200/800?random={random.randint(1000, 9999)}"
        },
        {
            "text": """üå± <b>–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç: –ù–µ–¥–æ–æ—Ü–µ–Ω–µ–Ω–Ω—ã–π –Ω–∞–≤—ã–∫ –ª–∏–¥–µ—Ä–∞ 2025</b>

–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ Harvard Business Review: –ª–∏–¥–µ—Ä—ã —Å –≤—ã—Å–æ–∫–∏–º EQ –¥–æ—Å—Ç–∏–≥–∞—é—Ç –Ω–∞ 37% –ª—É—á—à–∏—Ö –±–∏–∑–Ω–µ—Å-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤!

üß† <b>4 —Å—Ç–æ–ª–ø–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞:</b>
‚Ä¢ –°–∞–º–æ—Å–æ–∑–Ω–∞–Ω–∏–µ - –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–≤–æ–∏—Ö —ç–º–æ—Ü–∏–π
‚Ä¢ –°–∞–º–æ—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - –∫–æ–Ω—Ç—Ä–æ–ª—å —Ä–µ–∞–∫—Ü–∏–π
‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω–∞—è awareness - —ç–º–ø–∞—Ç–∏—è
‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏ - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–≤—è–∑–µ–π

üí° <b>–ü—Ä–∞–∫—Ç–∏–∫–∞:</b> –ï–∂–µ–¥–Ω–µ–≤–Ω–æ —É–¥–µ–ª—è–π—Ç–µ 5 –º–∏–Ω—É—Ç —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ —Å–≤–æ–∏—Ö —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∞–∫—Ü–∏–π.

üöÄ <b>–í—ã–∑–æ–≤:</b> –ü—Ä–æ–≤–µ–¥–∏—Ç–µ –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –≤—Å—Ç—Ä–µ—á—É 1-–Ω–∞-1 —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã.

ü§î <b>–ö–∞–∫ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –≤ –≤–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ?</b>

#–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç #–õ–∏–¥–µ—Ä—Å—Ç–≤–æ #EQ""",
            "image": f"https://picsum.photos/1200/800?random={random.randint(1000, 9999)}"
        }
    ]
    
    fallback = random.choice(fallback_posts)
    return fallback["text"], fallback["image"], "–†–µ–∑–µ—Ä–≤–Ω–∞—è —Ç–µ–º–∞"

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è GitHub Actions"""
    now = datetime.datetime.now()
    current_hour = now.hour
    
    print(f"üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ {now.strftime('%H:%M:%S')}")
    print(f"üìÖ –î–∞—Ç–∞: {now.strftime('%d.%m.%Y')}")
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø–æ—Å—Ç–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (UTC –≤—Ä–µ–º—è –≤ GitHub)
    utc_to_moscow = {
        6: "morning",   # 9:00 –ú–°–ö
        11: "afternoon", # 14:00 –ú–°–ö
        16: "evening"    # 19:00 –ú–°–ö
    }
    
    time_of_day = utc_to_moscow.get(current_hour, "afternoon")
    
    print(f"üéØ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è {time_of_day} –ø–æ—Å—Ç–∞...")
    
    post_text, image_url, theme = generate_unique_post(time_of_day)
    print(f"üìù –¢–µ–º–∞: {theme}")
    
    success = send_post_with_image(post_text, image_url)
    if success:
        print(f"‚úÖ {time_of_day} –ø–æ—Å—Ç —Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!")
    else:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ {time_of_day} –ø–æ—Å—Ç–∞")
    
    print("=" * 60)

if __name__ == "__main__":
    main()
