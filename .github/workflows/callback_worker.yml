      - name: ü§ñ Process Telegram Callbacks
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
        run: |
          echo "ü§ñ –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–∞–∂–∞—Ç—ã—Ö –∫–Ω–æ–ø–æ–∫..."
          echo "========================================"
          
          python -c "
import requests
import os
import sys
import json

BOT_TOKEN = os.environ.get('BOT_TOKEN')
print(f'üîë BOT_TOKEN: {'***' + BOT_TOKEN[-5:] if BOT_TOKEN else '–ù–ï–¢'}')

if not BOT_TOKEN:
    print('‚ùå BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω')
    exit(1)

# –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª—å
sys.path.append('.')
try:
    from approval_bot import process_callback
    print('‚úÖ –ú–æ–¥—É–ª—å approval_bot –∑–∞–≥—Ä—É–∂–µ–Ω')
except Exception as e:
    print(f'‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è: {e}')
    exit(1)

# –ß–∏—Ç–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π offset
try:
    with open('last_offset.txt', 'r') as f:
        offset = int(f.read().strip())
    print(f'üìä Offset –∏–∑ —Ñ–∞–π–ª–∞: {offset}')
except:
    offset = 0
    print(f'üìä –§–∞–π–ª offset –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º —Å 0')

# –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –í–°–ï–• –û–ë–ù–û–í–õ–ï–ù–ò–ô
print(f'üîÑ –ü–æ–ª—É—á–∞—é –í–°–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è...')
try:
    response = requests.get(
        f'https://api.telegram.org/bot{BOT_TOKEN}/getUpdates',
        params={'offset': 0, 'timeout': 30},
        timeout=35
    )
    
    print(f'üì® –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: {response.status_code}')
    
    if response.status_code == 200:
        data = response.json()
        print(f'üìä –û—Ç–≤–µ—Ç API - ok: {data.get('ok')}')
        print(f'üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: {len(data.get('result', []))}')
        
        # –í–´–í–û–î–ò–ú –í–°–ï –û–ë–ù–û–í–õ–ï–ù–ò–Ø –î–õ–Ø –î–ï–ë–ê–ì–ê
        updates = data.get('result', [])
        if updates:
            print(f'üéØ –í–°–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram:')
            for i, update in enumerate(updates):
                print(f'  {i+1}. Update ID: {update.get('update_id')}')
                if 'callback_query' in update:
                    print(f'     ‚úÖ CALLBACK!')
                    print(f'       Data: {update['callback_query'].get('data')}')
                    print(f'       ID: {update['callback_query'].get('id')}')
                else:
                    print(f'     üì≠ –ù–µ callback')
        
        if data.get('ok') and updates:
            print(f'üì® –ü–æ–ª—É—á–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: {len(updates)}')
            
            for update in updates:
                new_offset = update['update_id'] + 1
                
                if 'callback_query' in update:
                    callback = update['callback_query']
                    callback_data = callback.get('data', '')
                    callback_id = callback.get('id', '')
                    
                    print(f'')
                    print(f'üîî –û–ë–ù–ê–†–£–ñ–ï–ù–ê –ö–ù–û–ü–ö–ê!')
                    print(f'   Data: {callback_data}')
                    print(f'   ID: {callback_id}')
                    print(f'   User: {callback.get('from', {}).get('id')}')
                    
                    print(f'   üîÑ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é...')
                    success = process_callback(callback_data, callback_id)
                    
                    if success:
                        print(f'   ‚úÖ –£–°–ü–ï–•!')
                    else:
                        print(f'   ‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏')
                    
                    # –û—Ç–º–µ—á–∞–µ–º –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ
                    try:
                        requests.post(
                            f'https://api.telegram.org/bot{BOT_TOKEN}/answerCallbackQuery',
                            params={'callback_query_id': callback_id},
                            timeout=5
                        )
                        print(f'   üì§ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram')
                    except:
                        print(f'   ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç')
                    
                offset = new_offset
                print(f'   üìù –ù–æ–≤—ã–π offset: {offset}')
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º offset
        with open('last_offset.txt', 'w') as f:
            f.write(str(offset))
        print(f'üíæ Offset —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {offset}')
        
    else:
        print(f'‚ùå –û—à–∏–±–∫–∞ HTTP: {response.status_code}')
        print(f'üìÑ –û—Ç–≤–µ—Ç: {response.text[:200]}')
        
except Exception as e:
    print(f'üí• –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {e}')
    import traceback
    traceback.print_exc()

print('')
print('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞')
print('========================================')
"
