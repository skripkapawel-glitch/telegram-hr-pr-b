name: Save Generated Posts

on:
  workflow_run:
    workflows: ["Telegram HR Bot with Approval System"]
    types:
      - completed

jobs:
  save-files:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: üîÑ Download artifacts
        uses: actions/github-script@v6
        with:
          script: |
            const artifacts = await github.rest.actions.listWorkflowRunArtifacts({
              owner: context.repo.owner,
              repo: context.repo.repo,
              run_id: context.payload.workflow_run.id,
            });
            
            console.log('–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã:', artifacts.data.artifacts);
            
      - name: üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º pending —Ñ–∞–π–ª—ã
        run: |
          echo "üíæ –°–æ—Ö—Ä–∞–Ω—è—é —Ñ–∞–π–ª—ã..."
          
          # –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
          cp pending_*.json ./ 2>/dev/null || echo "–ù–µ—Ç pending —Ñ–∞–π–ª–æ–≤"
          cp published_*.json ./ 2>/dev/null || echo "–ù–µ—Ç published —Ñ–∞–π–ª–æ–≤"
          
          # –ö–æ–º–º–∏—Ç–∏–º
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          
          git add *.json
          git commit -m "Save generated posts [skip ci]" || echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π"
          git push || echo "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—à–∏—Ç—å"
