name: Telegram Bot - Direct Publishing

on:
  schedule:
    - cron: '55 7 * * *'    # 07:55 UTC = 10:55 –ú–°–ö (–∑–∞ 5 –º–∏–Ω –¥–æ 11:00)
    - cron: '55 11 * * *'   # 11:55 UTC = 14:55 –ú–°–ö (–∑–∞ 5 –º–∏–Ω –¥–æ 15:00)
    - cron: '55 16 * * *'   # 16:55 UTC = 19:55 –ú–°–ö (–∑–∞ 5 –º–∏–Ω –¥–æ 20:00)
  workflow_dispatch:        # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  generate-and-publish:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4
        
      - name: üêç Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: üì¶ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: ü§ñ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHANNEL_ID: ${{ secrets.CHANNEL_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
          ADMIN_CHAT_ID: ${{ secrets.ADMIN_CHAT_ID }}
          MANAGER_GITHUB_TOKEN: ${{ secrets.MANAGER_GITHUB_TOKEN }}
          REPO_NAME: ${{ secrets.REPO_NAME }}
        run: |
          echo "üöÄ –ó–∞–ø—É—Å–∫ Telegram Bot —Å –ø—Ä—è–º–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π..."
          echo "=" * 60
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
          if [ -z "$BOT_TOKEN" ]; then
            echo "‚ùå –û–®–ò–ë–ö–ê: BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
            exit 1
          fi
          
          if [ -z "$GEMINI_API_KEY" ]; then
            echo "‚ùå –û–®–ò–ë–ö–ê: GEMINI_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
            exit 1
          fi
          
          if [ -z "$PEXELS_API_KEY" ]; then
            echo "‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: PEXELS_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! –ë—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏"
          fi
          
          if [ -z "$MANAGER_GITHUB_TOKEN" ]; then
            echo "‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: MANAGER_GITHUB_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! –§—É–Ω–∫—Ü–∏–∏ GitHub API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"
          else
            echo "‚úÖ MANAGER_GITHUB_TOKEN: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–¥–ª–∏–Ω–∞: ${#MANAGER_GITHUB_TOKEN} —Å–∏–º–≤–æ–ª–æ–≤)"
          fi
          
          if [ -n "$REPO_NAME" ]; then
            echo "‚úÖ REPO_NAME: $REPO_NAME"
          fi
          
          echo "‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
          echo "üì§ –†–µ–∂–∏–º: –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ—Å—Ç–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é"
          echo "üéØ –¶–µ–ª–µ–≤—ã–µ –∫–∞–Ω–∞–ª—ã: @da4a_hr (TG) –∏ @tehdzenm (–î–∑–µ–Ω)"
          echo "üîë GitHub API: ${MANAGER_GITHUB_TOKEN:+‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω}${MANAGER_GITHUB_TOKEN:-\u26a0 –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω}"
          echo "=" * 60
          
          # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∑–∞–ø—É—Å–∫–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏–ª–∏ —Ä—É—á–Ω–æ–π)
          if [[ "${{ github.event_name }}" == "schedule" ]]; then
            echo "üìÖ –ó–ê–ü–£–°–ö –ü–û –†–ê–°–ü–ò–°–ê–ù–ò–Æ"
            echo "ü§ñ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º (--auto)"
            echo "=" * 60
            python github_bot.py --auto
          else
            echo "üëÜ –†–£–ß–ù–û–ô –ó–ê–ü–£–°–ö"
            echo "üîÑ –û–ø—Ä–µ–¥–µ–ª—è—é –±–ª–∏–∂–∞–π—à–∏–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–ª–æ—Ç..."
            echo "=" * 60
            python github_bot.py
          fi
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          EXIT_CODE=$?
          if [ $EXIT_CODE -eq 0 ]; then
            echo "‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ"
          elif [ $EXIT_CODE -eq 1 ]; then
            echo "‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ù–µ –≤—Ä–µ–º—è –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (–Ω–µ—Ç —Å–ª–æ—Ç–∞ ¬±10 –º–∏–Ω—É—Ç)"
          else
            echo "‚ùå –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —Å –æ—à–∏–±–∫–æ–π (–∫–æ–¥: $EXIT_CODE)"
            exit $EXIT_CODE
          fi
          
      - name: üìä Display Result
        if: always()
        run: |
          echo "=" * 60
          echo "üìã –ò–¢–û–ì–ò –ó–ê–ü–£–°–ö–ê:"
          echo "=" * 60
          
          echo "üéØ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
          echo ""
          echo "üì§ –ü–æ—Å—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é –≤ —á–∞—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"
          echo "üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –æ–¥–æ–±—Ä–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é"
          echo "‚è±Ô∏è –í—Ä–µ–º—è –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é: 10 –º–∏–Ω—É—Ç"
          echo ""
          echo "üéØ –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –ø–æ—Å—Ç—ã –±—É–¥—É—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –≤ –∫–∞–Ω–∞–ª—ã:"
          echo "‚Ä¢ @da4a_hr (Telegram) ‚Äî –∂–∏–≤–æ–π –¥–∏–Ω–∞–º–∏—á–Ω—ã–π —Å—Ç–∏–ª—å —Å —ç–º–æ–¥–∑–∏"
          echo "‚Ä¢ @tehdzenm (–Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω) ‚Äî –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å –±–µ–∑ —ç–º–æ–¥–∑–∏"
          echo ""
          echo "‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–π (–ú–°–ö):"
          echo "‚Ä¢ 11:00 ‚Äî –£—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Å—Ç (—ç–Ω–µ—Ä–≥–æ-—Å—Ç–∞—Ä—Ç, –ª–µ–≥–∫–∞—è –¥–∏–Ω–∞–º–∏–∫–∞)"
          echo "‚Ä¢ 15:00 ‚Äî –î–Ω–µ–≤–Ω–æ–π –ø–æ—Å—Ç (—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)"
          echo "‚Ä¢ 20:00 ‚Äî –í–µ—á–µ—Ä–Ω–∏–π –ø–æ—Å—Ç (–≥–ª—É–±–∏–Ω–∞ –∏ –∏—Å—Ç–æ—Ä–∏—è)"
          echo ""
          echo "‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏"
          echo "üñºÔ∏è –ö–∞—Ä—Ç–∏–Ω–∫–∏: Pexels API (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å)"
          echo "ü§ñ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è: Google Gemini AI"
          echo "üîê GitHub API: ${MANAGER_GITHUB_TOKEN:+‚úÖ –í–∫–ª—é—á–µ–Ω}${MANAGER_GITHUB_TOKEN:-\u26a0 –í—ã–∫–ª—é—á–µ–Ω}"
          echo ""
          echo "‚è∞ –°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é"
          echo "=" * 60
