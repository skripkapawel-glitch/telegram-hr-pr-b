name: Telegram Bot - Direct Publishing

on:
  schedule:
    - cron: '0 6 * * *'    # 09:00 –ú–°–ö (06:00 UTC)
    - cron: '0 11 * * *'   # 14:00 –ú–°–ö (11:00 UTC)
    - cron: '0 16 * * *'   # 19:00 –ú–°–ö (16:00 UTC)
  workflow_dispatch:        # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  generate-and-publish:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4
        
      - name: üêç Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: üì¶ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: ü§ñ Generate and Publish Posts
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHANNEL_ID: ${{ secrets.CHANNEL_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          ADMIN_CHAT_ID: ${{ secrets.ADMIN_CHAT_ID }}
        run: |
          echo "üöÄ –ó–∞–ø—É—Å–∫ Telegram Bot —Å –ø—Ä—è–º–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π..."
          echo "=" * 60
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
          if [ -z "$BOT_TOKEN" ]; then
            echo "‚ùå –û–®–ò–ë–ö–ê: BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
            exit 1
          fi
          
          if [ -z "$GEMINI_API_KEY" ]; then
            echo "‚ùå –û–®–ò–ë–ö–ê: GEMINI_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
            exit 1
          fi
          
          echo "‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
          echo "üì§ –†–µ–∂–∏–º: –ü—Ä—è–º–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –∫–∞–Ω–∞–ª—ã"
          echo "=" * 60
          
          # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ once
          python github_bot.py --once
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          if [ $? -eq 0 ]; then
            echo "‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ"
          else
            echo "‚ùå –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —Å –æ—à–∏–±–∫–æ–π"
            exit 1
          fi
          
      - name: üìä Display Result
        if: always()
        run: |
          echo "=" * 60
          echo "üìã –ò–¢–û–ì–ò –ó–ê–ü–£–°–ö–ê:"
          echo "=" * 60
          
          echo "üì§ –ü–æ—Å—Ç—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∫–∞–Ω–∞–ª—ã:"
          echo "‚Ä¢ @da4a_hr (Telegram)"
          echo "‚Ä¢ @tehdzenm (–Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω)"
          echo ""
          echo "‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ –ø—Ä—è–º–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏"
          echo "‚è∞ –°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é"
          
          echo "=" * 60
