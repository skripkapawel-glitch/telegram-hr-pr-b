name: Telegram HR Bot with Approval System

on:
  schedule:
    - cron: '0 6 * * *'  # 09:00 –ú–°–ö (06:00 UTC)
    - cron: '0 11 * * *' # 14:00 –ú–°–ö (11:00 UTC)
    - cron: '0 16 * * *' # 19:00 –ú–°–ö (16:00 UTC)
  workflow_dispatch:

jobs:
  generate-and-approve:
    runs-on: ubuntu-latest
    
    timeout-minutes: 15
    
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4
        
      - name: üêç Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: üì¶ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: ü§ñ Generate Posts
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          ADMIN_CHAT_ID: ${{ secrets.ADMIN_CHAT_ID }}
          CHANNEL_ID: ${{ secrets.CHANNEL_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          echo "üöÄ –ó–∞–ø—É—Å–∫ Telegram HR Bot —Å —Å–∏—Å—Ç–µ–º–æ–π —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è..."
          echo "=" * 60
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
          if [ -z "$BOT_TOKEN" ]; then
            echo "‚ùå –û–®–ò–ë–ö–ê: BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
            exit 1
          fi
          
          if [ -z "$GEMINI_API_KEY" ]; then
            echo "‚ùå –û–®–ò–ë–ö–ê: GEMINI_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
            exit 1
          fi
          
          if [ -z "$ADMIN_CHAT_ID" ]; then
            echo "‚ö†Ô∏è  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: ADMIN_CHAT_ID –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
            echo "üì§ –ü–æ—Å—Ç—ã –±—É–¥—É—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
          else
            echo "‚úÖ ADMIN_CHAT_ID —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
            echo "üì® –ü–æ—Å—Ç—ã –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ"
          fi
          
          echo "=" * 60
          
          # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
          python github_bot.py
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          if [ $? -eq 0 ]; then
            echo "‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ"
          else
            echo "‚ùå –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —Å –æ—à–∏–±–∫–æ–π"
            exit 1
          fi
          
      - name: üìä Display Result
        if: always()
        run: |
          echo "=" * 60
          echo "üìã –ò–¢–û–ì–ò –ó–ê–ü–£–°–ö–ê:"
          echo "=" * 60
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª—ã –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
          if ls pending_*.json 1> /dev/null 2>&1; then
            echo "üì® –ü–æ—Å—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ!"
            echo "üëÜ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram –¥–ª—è —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"
            echo ""
            echo "‚ö° –ö–∞–∫ —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å:"
            echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram"
            echo "2. –ù–∞–π–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –±–æ—Ç–∞"
            echo "3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É '‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å'"
            echo "   –∏–ª–∏ '‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å' –ø–æ–¥ –∫–∞–∂–¥—ã–º –ø–æ—Å—Ç–æ–º"
          else
            if [ -n "$ADMIN_CHAT_ID" ]; then
              echo "‚ö†Ô∏è  –ù–µ—Ç –ø–æ—Å—Ç–æ–≤ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ"
              echo "‚ÑπÔ∏è  –í–æ–∑–º–æ–∂–Ω–æ, –≤—Ä–µ–º—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º"
            else
              echo "üì§ –ü–æ—Å—Ç—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
              echo "‚ÑπÔ∏è  ADMIN_CHAT_ID –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
            fi
          fi
          
          echo "=" * 60
          
      - name: üßπ Cleanup
        if: always()
        run: |
          # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ 1 –¥–Ω—è
          find . -name "pending_*.json" -mtime +1 -delete 2>/dev/null || true
          find . -name "published_*.json" -mtime +1 -delete 2>/dev/null || true
          
          echo "üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
